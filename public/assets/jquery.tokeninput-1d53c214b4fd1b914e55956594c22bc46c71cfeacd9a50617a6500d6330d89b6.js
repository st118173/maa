!function(e){var t={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:!0,theme:null,zindex:999,resultsLimit:null,resultsFormatter:function(e){return"<li>"+e[this.propertyToSearch]+"</li>"},tokenFormatter:function(e){return"<li><p>"+e[this.propertyToSearch]+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",onResult:null,onAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1},n={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"},i={BEFORE:0,AFTER:1,END:2},r={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},s={init:function(n,i){var r=e.extend({},t,i||{});return this.each(function(){e(this).data("tokenInputObject",new e.TokenList(this,n,r))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(e){return this.data("tokenInputObject").add(e),this},remove:function(e){return this.data("tokenInputObject").remove(e),this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(e){return this.data("tokenInputObject").toggleDisabled(e),this}};e.fn.tokenInput=function(e){return s[e]?s[e].apply(this,Array.prototype.slice.call(arguments,1)):s.init.apply(this,arguments)},e.TokenList=function(t,s,o){function a(t){"boolean"==typeof t?o.disabled=t:o.disabled=!o.disabled,N.prop("disabled",o.disabled),H.toggleClass(o.classes.disabled,o.disabled),D&&h(e(D),i.END),U.prop("disabled",o.disabled)}function l(){if(null!==o.tokenLimit&&L>=o.tokenLimit)return N.hide(),void b()}function u(){if(P!==(P=N.val())){var e=P.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");$.html(e),N.width($.width()+30)}}function c(t){var n=e(o.tokenFormatter(t)),i=t.readonly===!0;i&&n.addClass(o.classes.tokenReadOnly),n.addClass(o.classes.token).insertBefore(Y),i||e("<span>"+o.deleteText+"</span>").addClass(o.classes.tokenDelete).appendTo(n).click(function(){if(!o.disabled)return g(e(this).parent()),U.change(),!1});var r=t;return e.data(n.get(0),"tokeninput",t),O=O.slice(0,M).concat([r]).concat(O.slice(M)),M++,m(O,U),L+=1,null!==o.tokenLimit&&L>=o.tokenLimit&&(N.hide(),b()),n}function d(t){var n=o.onAdd;if(L>0&&o.preventDuplicates){var i=null;if(H.children().each(function(){var n=e(this),r=e.data(n.get(0),"tokeninput");if(r&&r.id===t.id)return i=n,!1}),i)return p(i),Y.insertAfter(i),void j(N)}(null==o.tokenLimit||L<o.tokenLimit)&&(c(t),l()),N.val(""),b(),e.isFunction(n)&&n.call(U,t)}function p(e){o.disabled||(e.addClass(o.classes.selectedToken),D=e.get(0),N.val(""),b())}function h(e,t){e.removeClass(o.classes.selectedToken),D=null,t===i.BEFORE?(Y.insertBefore(e),M--):t===i.AFTER?(Y.insertAfter(e),M++):(Y.appendTo(H),M=L),j(N)}function f(t){var n=D;D&&h(e(D),i.END),n===t.get(0)?h(t,i.END):p(t)}function g(t){var n=e.data(t.get(0),"tokeninput"),i=o.onDelete,r=t.prevAll().length;r>M&&r--,t.remove(),D=null,j(N),O=O.slice(0,r).concat(O.slice(r+1)),r<M&&M--,m(O,U),L-=1,null!==o.tokenLimit&&(N.show().val(""),j(N)),e.isFunction(i)&&i.call(U,n)}function m(t,n){var i=e.map(t,function(e){return"function"==typeof o.tokenValue?o.tokenValue.call(this,e):e[o.tokenValue]});n.val(i.join(o.tokenDelimiter))}function b(){z.hide().empty(),B=null}function y(){z.css({position:"absolute",top:e(H).offset().top+e(H).outerHeight(),left:e(H).offset().left,width:e(H).outerWidth(),"z-index":o.zindex}).show()}function v(){o.searchingText&&(z.html("<p>"+o.searchingText+"</p>"),y())}function w(){o.hintText&&(z.html("<p>"+o.hintText+"</p>"),y())}function x(e){return e.replace(G,"\\$&")}function _(e,t){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+x(t)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")}function q(e,t,n){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+x(t)+")(?![^<>]*>)(?![^&;]+;)","g"),_(t,n))}function E(t,n){if(n&&n.length){z.empty();var i=e("<ul>").appendTo(z).mouseover(function(t){k(e(t.target).closest("li"))}).mousedown(function(t){return d(e(t.target).closest("li").data("tokeninput")),U.change(),!1}).hide();o.resultsLimit&&n.length>o.resultsLimit&&(n=n.slice(0,o.resultsLimit)),e.each(n,function(n,r){var s=o.resultsFormatter(r);s=q(s,r[o.propertyToSearch],t),s=e(s).appendTo(i),n%2?s.addClass(o.classes.dropdownItem):s.addClass(o.classes.dropdownItem2),0===n&&k(s),e.data(s.get(0),"tokeninput",r)}),y(),o.animateDropdown?i.slideDown("fast"):i.show()}else o.noResultsText&&(z.html("<p>"+o.noResultsText+"</p>"),y())}function k(t){t&&(B&&S(e(B)),t.addClass(o.classes.selectedDropdownItem),B=t.get(0))}function S(e){e.removeClass(o.classes.selectedDropdownItem),B=null}function C(){var t=N.val();t&&t.length&&(D&&h(e(D),i.AFTER),t.length>=o.minChars?(v(),clearTimeout(R),R=setTimeout(function(){T(t)},o.searchDelay)):b())}function T(t){var n=t+I(),i=F.get(n);if(i)E(t,i);else if(o.url){var r=I(),s={};if(s.data={},r.indexOf("?")>-1){var a=r.split("?");s.url=a[0];var l=a[1].split("&");e.each(l,function(e,t){var n=t.split("=");s.data[n[0]]=n[1]})}else s.url=r;s.data[o.queryParam]=t,s.type=o.method,s.dataType=o.contentType,o.crossDomain&&(s.dataType="jsonp"),s.success=function(i){e.isFunction(o.onResult)&&(i=o.onResult.call(U,i)),F.add(n,o.jsonContainer?i[o.jsonContainer]:i),N.val()===t&&E(t,o.jsonContainer?i[o.jsonContainer]:i)},e.ajax(s)}else if(o.local_data){var u=e.grep(o.local_data,function(e){return e[o.propertyToSearch].toLowerCase().indexOf(t.toLowerCase())>-1});e.isFunction(o.onResult)&&(u=o.onResult.call(U,u)),F.add(n,u),E(t,u)}}function I(){var e=o.url;return"function"==typeof o.url&&(e=o.url.call(o)),e}function j(e){setTimeout(function(){e.focus()},50)}if("string"===e.type(s)||"function"===e.type(s)){o.url=s;var A=I();void 0===o.crossDomain&&"string"==typeof A&&(A.indexOf("://")===-1?o.crossDomain=!1:o.crossDomain=location.href.split(/\/+/g)[1]!==A.split(/\/+/g)[1])}else"object"==typeof s&&(o.local_data=s);o.classes?o.classes=e.extend({},n,o.classes):o.theme?(o.classes={},e.each(n,function(e,t){o.classes[e]=t+"-"+o.theme})):o.classes=n;var R,P,O=[],L=0,F=new e.TokenList.Cache,N=e('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",o.idPrefix+t.id).focus(function(){return!o.disabled&&(null!==o.tokenLimit&&o.tokenLimit===L||w(),void H.addClass(o.classes.focused))}).blur(function(){b(),e(this).val(""),H.removeClass(o.classes.focused)}).bind("keyup keydown blur update",u).keydown(function(t){var n,s;switch(t.keyCode){case r.LEFT:case r.RIGHT:case r.UP:case r.DOWN:if(e(this).val()){var o=null;o=t.keyCode===r.DOWN||t.keyCode===r.RIGHT?e(B).next():e(B).prev(),o.length&&k(o)}else n=Y.prev(),s=Y.next(),n.length&&n.get(0)===D||s.length&&s.get(0)===D?t.keyCode===r.LEFT||t.keyCode===r.UP?h(e(D),i.BEFORE):h(e(D),i.AFTER):t.keyCode!==r.LEFT&&t.keyCode!==r.UP||!n.length?t.keyCode!==r.RIGHT&&t.keyCode!==r.DOWN||!s.length||p(e(s.get(0))):p(e(n.get(0)));return!1;case r.BACKSPACE:if(n=Y.prev(),!e(this).val().length)return D?(g(e(D)),U.change()):n.length&&p(e(n.get(0))),!1;1===e(this).val().length?b():setTimeout(function(){C()},5);break;case r.TAB:case r.ENTER:case r.NUMPAD_ENTER:case r.COMMA:if(B)return d(e(B).data("tokeninput")),U.change(),!1;break;case r.ESCAPE:return b(),!0;default:String.fromCharCode(t.which)&&setTimeout(function(){C()},5)}}),U=e(t).hide().val("").focus(function(){j(N)}).blur(function(){N.blur()}),D=null,M=0,B=null,H=e("<ul />").addClass(o.classes.tokenList).click(function(t){var n=e(t.target).closest("li");n&&n.get(0)&&e.data(n.get(0),"tokeninput")?f(n):(D&&h(e(D),i.END),j(N))}).mouseover(function(t){var n=e(t.target).closest("li");n&&D!==this&&n.addClass(o.classes.highlightedToken)}).mouseout(function(t){var n=e(t.target).closest("li");n&&D!==this&&n.removeClass(o.classes.highlightedToken)}).insertBefore(U),Y=e("<li />").addClass(o.classes.inputToken).appendTo(H).append(N),z=e("<div>").addClass(o.classes.dropdown).appendTo("body").hide(),$=e("<tester/>").insertAfter(N).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:N.css("fontSize"),fontFamily:N.css("fontFamily"),fontWeight:N.css("fontWeight"),letterSpacing:N.css("letterSpacing"),whiteSpace:"nowrap"});U.val("");var W=o.prePopulate||U.data("pre");o.processPrePopulate&&e.isFunction(o.onResult)&&(W=o.onResult.call(U,W)),W&&W.length&&e.each(W,function(e,t){c(t),l()}),o.disabled&&a(!0),e.isFunction(o.onReady)&&o.onReady.call(),this.clear=function(){H.children("li").each(function(){0===e(this).children("input").length&&g(e(this))})},this.add=function(e){d(e)},this.remove=function(t){H.children("li").each(function(){if(0===e(this).children("input").length){var n=e(this).data("tokeninput"),i=!0;for(var r in t)if(t[r]!==n[r]){i=!1;break}i&&g(e(this))}})},this.getTokens=function(){return O},this.toggleDisabled=function(e){a(e)};var G=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g")},e.TokenList.Cache=function(t){var n=e.extend({max_size:500},t),i={},r=0,s=function(){i={},r=0};this.add=function(e,t){r>n.max_size&&s(),i[e]||(r+=1),i[e]=t},this.get=function(e){return i[e]}}}(jQuery);