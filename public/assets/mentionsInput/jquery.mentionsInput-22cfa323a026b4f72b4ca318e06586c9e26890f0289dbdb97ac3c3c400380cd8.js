!function(e,t){var i={BACKSPACE:8,TAB:9,RETURN:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,COMMA:188,SPACE:32,HOME:36,END:35},n={triggerChar:"@",onDataRequest:e.noop,minChars:2,allowRepeat:!1,showAvatars:!0,elastic:!0,defaultValue:"",onCaret:!1,classes:{autoCompleteItemActive:"active"},templates:{wrapper:t.template('<div class="mentions-input-box"></div>'),autocompleteList:t.template('<div class="mentions-autocomplete-list"></div>'),autocompleteListItem:t.template('<li data-ref-id="<%= id %>" data-ref-type="<%= type %>" data-display="<%= display %>"><%= content %></li>'),autocompleteListItemAvatar:t.template('<img src="<%= avatar %>" />'),autocompleteListItemIcon:t.template('<div class="icon <%= icon %>"></div>'),mentionsOverlay:t.template('<div class="mentions"><div></div></div>'),mentionItemSyntax:t.template("@[<%= value %>](<%= type %>:<%= id %>)"),mentionItemHighlight:t.template("<strong><span><%= value %></span></strong>")}},r={htmlEncode:function(e){return t.escape(e)},regexpEncode:function(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},highlightTerm:function(e,t){return t||t.length?e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>"):e},setCaratPosition:function(e,t){if(e.createTextRange){var i=e.createTextRange();i.move("character",t),i.select()}else e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()},rtrim:function(e){return e.replace(/\s+$/,"")}},o=function(o){function s(){L=e(S),"true"!==L.attr("data-mentions-input")&&(E=L.parent(),j=e(o.templates.wrapper()),L.wrapAll(j),j=E.find("> div.mentions-input-box"),L.attr("data-mentions-input","true"),L.bind("keydown",w),L.bind("keypress",_),L.bind("click",v),L.bind("blur",y),navigator.userAgent.indexOf("MSIE 8")>-1?L.bind("propertychange",b):L.bind("input",b),o.elastic&&L.elastic())}function a(){N=e(o.templates.autocompleteList()),N.appendTo(j),N.delegate("li","mousedown",g)}function l(){I=e(o.templates.mentionsOverlay()),I.prependTo(j)}function u(){var e=f();t.each(P,function(t){var i=o.templates.mentionItemSyntax(t);e=e.replace(new RegExp(r.regexpEncode(t.value),"g"),i)});var i=r.htmlEncode(e);t.each(P,function(e){var n=t.extend({},e,{value:r.htmlEncode(e.value)}),s=o.templates.mentionItemSyntax(n),a=o.templates.mentionItemHighlight(n);i=i.replace(new RegExp(r.regexpEncode(s),"g"),a)}),i=i.replace(/\n/g,"<br />"),i=i.replace(/ {2}/g,"&nbsp; "),L.data("messageText",e),L.trigger("updated"),I.find("div").html(i)}function c(){H=[]}function d(){var e=f();P=t.reject(P,function(t){return!t.value||e.indexOf(t.value)==-1}),P=t.compact(P)}function h(e){var i=f(),n=new RegExp("\\"+o.triggerChar+Y,"gi");n.exec(i);var s=n.lastIndex-Y.length-1,a=n.lastIndex,l=i.substr(0,s),d=i.substr(a,i.length),h=(l+e.value).length+1;t.find(P,function(t){return t.id==e.id})||P.push(e),c(),Y="",x();var p=l+e.value+" "+d;L.val(p),L.trigger("mention"),u(),L.focus(),r.setCaratPosition(L[0],h)}function f(){return e.trim(L.val())}function p(t){var i,n,r,o,s,a,l,u,c,d,h;if((c=t[0])&&e(c).is("textarea")&&null!=c.selectionEnd){for(l={position:"absolute",overflow:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word",boxSizing:"content-box",top:0,left:-9999},u=["boxSizing","fontFamily","fontSize","fontStyle","fontVariant","fontWeight","height","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","textDecoration","textIndent","textTransform","width","word-spacing"],d=0,h=u.length;d<h;d++)s=u[d],l[s]=e(c).css(s);return r=document.createElement("div"),e(r).css(l),e(c).after(r),n=document.createTextNode(c.value.substring(0,c.selectionEnd)),i=document.createTextNode(c.value.substring(c.selectionEnd)),o=document.createElement("span"),o.innerHTML="&nbsp;",r.appendChild(n),r.appendChild(o),r.appendChild(i),r.scrollTop=c.scrollTop,a=e(o).position(),e(r).remove(),a}}function m(){var t=e(L).offset().top,i=e("body").offset().top,n=e(window).scrollTop();n>t&&e(window).scrollTop(t-i)}function g(){var t=e(this),i=F[t.attr("data-uid")];return h(i),m(),!1}function v(){c()}function y(){x()}function b(){u(),d();var e=t.lastIndexOf(H,o.triggerChar);e>-1&&(Y=H.slice(e+1).join(""),Y=r.rtrim(Y),t.defer(t.bind(C,this,Y)))}function _(e){if(e.keyCode!==i.BACKSPACE){var t=String.fromCharCode(e.which||e.keyCode);H.push(t)}}function w(n){if(n.keyCode===i.LEFT||n.keyCode===i.RIGHT||n.keyCode===i.HOME||n.keyCode===i.END)return t.defer(c),void(navigator.userAgent.indexOf("MSIE 9")>-1&&t.defer(u));if(n.keyCode===i.BACKSPACE)return void(H=H.slice(0,-1+H.length));if(!N.is(":visible"))return!0;switch(n.keyCode){case i.UP:case i.DOWN:var r=null;return r=n.keyCode===i.DOWN?A&&A.length?A.next():N.find("li").first():e(A).prev(),r.length&&k(r),!1;case i.RETURN:case i.TAB:if(A&&A.length)return A.trigger("mousedown"),!1}return!0}function x(){A=null,N.empty().hide()}function k(e){e.addClass(o.classes.autoCompleteItemActive),e.siblings().removeClass(o.classes.autoCompleteItemActive),A=e}function T(i,n){if(N.show(),!o.allowRepeat){var s=t.pluck(P,"value");n=t.reject(n,function(e){return t.include(s,e.name)})}if(!n.length)return void x();N.empty();var a=e("<ul>").appendTo(N).hide();t.each(n,function(n,s){var l=t.uniqueId("mention_");F[l]=t.extend({},n,{value:n.name});var u=e(o.templates.autocompleteListItem({id:r.htmlEncode(n.id),display:r.htmlEncode(n.name),type:r.htmlEncode(n.type),content:r.highlightTerm(r.htmlEncode(n.display?n.display:n.name),i)})).attr("data-uid",l);if(0===s&&k(u),o.showAvatars){var c;c=e(n.avatar?o.templates.autocompleteListItemAvatar({avatar:n.avatar}):o.templates.autocompleteListItemIcon({icon:n.icon})),c.prependTo(u)}u=u.appendTo(a)}),N.show(),o.onCaret&&D(N,L),a.show()}function C(e){e&&e.length&&e.length>=o.minChars?o.onDataRequest.call(this,"search",e,function(t){T(e,t)}):x()}function D(e,t){var i=p(t),n=parseInt(t.css("line-height"),10)||18;e.css("width","15em"),e.css("left",i.left),e.css("top",n+i.top);var r=t.offset().left+t.width(),o=e.offset().left+e.width();r<=o&&e.css("left",Math.abs(e.position().left-(o-r)))}function M(e){P=[];for(var t,i=r.htmlEncode(e),n=new RegExp("("+o.triggerChar+")\\[(.*?)\\]\\((.*?):(.*?)\\)","gi"),s=i;null!=(t=n.exec(i));)s=s.replace(t[0],t[1]+t[2]),P.push({id:t[4],type:t[3],value:t[2],trigger:t[1]});L.val(s),u()}var S,L,E,N,j,I,A,P=[],F={},H=[],Y="";return o=e.extend(!0,{},n,o),{init:function(e){S=e,s(),a(),l(),M(o.defaultValue),o.prefillMention&&h(o.prefillMention)},val:function(e){t.isFunction(e)&&e.call(this,P.length?L.data("messageText"):f())},reset:function(){M()},getMentions:function(e){t.isFunction(e)&&e.call(this,P)}}};e.fn.mentionsInput=function(i,n){var r=arguments;return"object"!=typeof i&&i||(n=i),this.each(function(){var s=e.data(this,"mentionsInput")||e.data(this,"mentionsInput",new o(n));return t.isFunction(s[i])?s[i].apply(this,Array.prototype.slice.call(r,1)):"object"!=typeof i&&i?void e.error("Method "+i+" does not exist"):s.init.call(this,this)})}}(jQuery,_);