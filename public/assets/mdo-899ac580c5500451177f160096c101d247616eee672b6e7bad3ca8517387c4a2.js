function payWithStripe(e){if(e.preventDefault(),validator.form()){$form.find(".subscribe").html('Validating <i class="fa fa-spinner fa-pulse"></i>').prop("disabled",!0);var t="pk_test_6pRNASCoBOKtIshFeQd4XMUh";Stripe.setPublishableKey(t);var n=$form.find("[name=cardExpiry]").payment("cardExpiryVal"),i={number:$form.find("[name=cardNumber]").val().replace(/\s/g,""),cvc:$form.find("[name=cardCVC]").val(),exp_month:n.month,exp_year:n.year};Stripe.card.createToken(i,function(e,t){if(t.error)$form.find(".subscribe").html("Try again").prop("disabled",!1),$form.find(".payment-errors").text(t.error.message),$form.find(".payment-errors").closest(".row").show();else{$form.find(".subscribe").html('Processing <i class="fa fa-spinner fa-pulse"></i>'),$form.find(".payment-errors").closest(".row").hide(),$form.find(".payment-errors").text(""),console.log(t.id),console.log(t.card);var n=t.id;$.post("/account/stripe_card_token",{token:n}).done(function(){$form.find(".subscribe").html('Payment successful <i class="fa fa-check"></i>')}).fail(function(){$form.find(".subscribe").html("There was a problem").removeClass("success").addClass("error"),$form.find(".payment-errors").text("Try refreshing the page and trying again."),$form.find(".payment-errors").closest(".row").show()})}})}}var $form=$("#payment-form");$form.find(".subscribe").on("click",payWithStripe),$("input[name=cardNumber]").payment("formatCardNumber"),$("input[name=cardCVC]").payment("formatCardCVC"),$("input[name=cardExpiry").payment("formatCardExpiry"),jQuery.validator.addMethod("cardNumber",function(e,t){return this.optional(t)||Stripe.card.validateCardNumber(e)},"Please specify a valid credit card number."),jQuery.validator.addMethod("cardExpiry",function(e,t){return e=$.payment.cardExpiryVal(e),this.optional(t)||Stripe.card.validateExpiry(e.month,e.year)},"Invalid expiration date."),jQuery.validator.addMethod("cardCVC",function(e,t){return this.optional(t)||Stripe.card.validateCVC(e)},"Invalid CVC."),validator=$form.validate({rules:{cardNumber:{required:!0,cardNumber:!0},cardExpiry:{required:!0,cardExpiry:!0},cardCVC:{required:!0,cardCVC:!0}},highlight:function(e){$(e).closest(".form-control").removeClass("success").addClass("error")},unhighlight:function(e){$(e).closest(".form-control").removeClass("error").addClass("success")},errorPlacement:function(e,t){$(t).closest(".form-group").append(e)}}),paymentFormReady=function(){return!!($form.find("[name=cardNumber]").hasClass("success")&&$form.find("[name=cardExpiry]").hasClass("success")&&$form.find("[name=cardCVC]").val().length>1)},$form.find(".subscribe").prop("disabled",!0);var readyInterval=setInterval(function(){paymentFormReady()&&($form.find(".subscribe").prop("disabled",!1),clearInterval(readyInterval))},250);