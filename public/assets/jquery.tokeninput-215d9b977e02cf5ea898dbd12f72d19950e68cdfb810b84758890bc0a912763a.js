!function(e){var t={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:!0,theme:null,zindex:999,resultsLimit:null,resultsFormatter:function(e){return"<li>"+e[this.propertyToSearch]+"</li>"},tokenFormatter:function(e){return"<li><p>"+e[this.propertyToSearch]+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",onResult:null,onAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1},n={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"},r={BEFORE:0,AFTER:1,END:2},i={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},s={init:function(n,r){var i=e.extend({},t,r||{});return this.each(function(){e(this).data("tokenInputObject",new e.TokenList(this,n,i))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(e){return this.data("tokenInputObject").add(e),this},remove:function(e){return this.data("tokenInputObject").remove(e),this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(e){return this.data("tokenInputObject").toggleDisabled(e),this}};e.fn.tokenInput=function(e){return s[e]?s[e].apply(this,Array.prototype.slice.call(arguments,1)):s.init.apply(this,arguments)},e.TokenList=function(t,s,a){function o(t){"boolean"==typeof t?a.disabled=t:a.disabled=!a.disabled,N.prop("disabled",a.disabled),D.toggleClass(a.classes.disabled,a.disabled),M&&h(e(M),r.END),F.prop("disabled",a.disabled)}function u(){if(null!==a.tokenLimit&&P>=a.tokenLimit)return N.hide(),void b()}function l(){if(R!==(R=N.val())){var e=R.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");G.html(e),N.width(G.width()+30)}}function c(t){var n=e(a.tokenFormatter(t)),r=t.readonly===!0;r&&n.addClass(a.classes.tokenReadOnly),n.addClass(a.classes.token).insertBefore(H),r||e("<span>"+a.deleteText+"</span>").addClass(a.classes.tokenDelete).appendTo(n).click(function(){if(!a.disabled)return g(e(this).parent()),F.change(),!1});var i=t;return e.data(n.get(0),"tokeninput",t),O=O.slice(0,B).concat([i]).concat(O.slice(B)),B++,m(O,F),P+=1,null!==a.tokenLimit&&P>=a.tokenLimit&&(N.hide(),b()),n}function d(t){var n=a.onAdd;if(P>0&&a.preventDuplicates){var r=null;if(D.children().each(function(){var n=e(this),i=e.data(n.get(0),"tokeninput");if(i&&i.id===t.id)return r=n,!1}),r)return p(r),H.insertAfter(r),void T(N)}(null==a.tokenLimit||P<a.tokenLimit)&&(c(t),u()),N.val(""),b(),e.isFunction(n)&&n.call(F,t)}function p(e){a.disabled||(e.addClass(a.classes.selectedToken),M=e.get(0),N.val(""),b())}function h(e,t){e.removeClass(a.classes.selectedToken),M=null,t===r.BEFORE?(H.insertBefore(e),B--):t===r.AFTER?(H.insertAfter(e),B++):(H.appendTo(D),B=P),T(N)}function f(t){var n=M;M&&h(e(M),r.END),n===t.get(0)?h(t,r.END):p(t)}function g(t){var n=e.data(t.get(0),"tokeninput"),r=a.onDelete,i=t.prevAll().length;i>B&&i--,t.remove(),M=null,T(N),O=O.slice(0,i).concat(O.slice(i+1)),i<B&&B--,m(O,F),P-=1,null!==a.tokenLimit&&(N.show().val(""),T(N)),e.isFunction(r)&&r.call(F,n)}function m(t,n){var r=e.map(t,function(e){return"function"==typeof a.tokenValue?a.tokenValue.call(this,e):e[a.tokenValue]});n.val(r.join(a.tokenDelimiter))}function b(){z.hide().empty(),Y=null}function y(){z.css({position:"absolute",top:e(D).offset().top+e(D).outerHeight(),left:e(D).offset().left,width:e(D).outerWidth(),"z-index":a.zindex}).show()}function v(){a.searchingText&&(z.html("<p>"+a.searchingText+"</p>"),y())}function q(){a.hintText&&(z.html("<p>"+a.hintText+"</p>"),y())}function w(e){return e.replace(V,"\\$&")}function x(e,t){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+w(t)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")}function _(e,t,n){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+w(t)+")(?![^<>]*>)(?![^&;]+;)","g"),x(t,n))}function k(t,n){if(n&&n.length){z.empty();var r=e("<ul>").appendTo(z).mouseover(function(t){E(e(t.target).closest("li"))}).mousedown(function(t){return d(e(t.target).closest("li").data("tokeninput")),F.change(),!1}).hide();a.resultsLimit&&n.length>a.resultsLimit&&(n=n.slice(0,a.resultsLimit)),e.each(n,function(n,i){var s=a.resultsFormatter(i);s=_(s,i[a.propertyToSearch],t),s=e(s).appendTo(r),n%2?s.addClass(a.classes.dropdownItem):s.addClass(a.classes.dropdownItem2),0===n&&E(s),e.data(s.get(0),"tokeninput",i)}),y(),a.animateDropdown?r.slideDown("fast"):r.show()}else a.noResultsText&&(z.html("<p>"+a.noResultsText+"</p>"),y())}function E(t){t&&(Y&&S(e(Y)),t.addClass(a.classes.selectedDropdownItem),Y=t.get(0))}function S(e){e.removeClass(a.classes.selectedDropdownItem),Y=null}function C(){var t=N.val();t&&t.length&&(M&&h(e(M),r.AFTER),t.length>=a.minChars?(v(),clearTimeout(L),L=setTimeout(function(){j(t)},a.searchDelay)):b())}function j(t){var n=t+I(),r=U.get(n);if(r)k(t,r);else if(a.url){var i=I(),s={};if(s.data={},i.indexOf("?")>-1){var o=i.split("?");s.url=o[0];var u=o[1].split("&");e.each(u,function(e,t){var n=t.split("=");s.data[n[0]]=n[1]})}else s.url=i;s.data[a.queryParam]=t,s.type=a.method,s.dataType=a.contentType,a.crossDomain&&(s.dataType="jsonp"),s.success=function(r){e.isFunction(a.onResult)&&(r=a.onResult.call(F,r)),U.add(n,a.jsonContainer?r[a.jsonContainer]:r),N.val()===t&&k(t,a.jsonContainer?r[a.jsonContainer]:r)},e.ajax(s)}else if(a.local_data){var l=e.grep(a.local_data,function(e){return e[a.propertyToSearch].toLowerCase().indexOf(t.toLowerCase())>-1});e.isFunction(a.onResult)&&(l=a.onResult.call(F,l)),U.add(n,l),k(t,l)}}function I(){var e=a.url;return"function"==typeof a.url&&(e=a.url.call(a)),e}function T(e){setTimeout(function(){e.focus()},50)}if("string"===e.type(s)||"function"===e.type(s)){a.url=s;var A=I();void 0===a.crossDomain&&"string"==typeof A&&(A.indexOf("://")===-1?a.crossDomain=!1:a.crossDomain=location.href.split(/\/+/g)[1]!==A.split(/\/+/g)[1])}else"object"==typeof s&&(a.local_data=s);a.classes?a.classes=e.extend({},n,a.classes):a.theme?(a.classes={},e.each(n,function(e,t){a.classes[e]=t+"-"+a.theme})):a.classes=n;var L,R,O=[],P=0,U=new e.TokenList.Cache,N=e('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",a.idPrefix+t.id).focus(function(){return!a.disabled&&(null!==a.tokenLimit&&a.tokenLimit===P||q(),void D.addClass(a.classes.focused))}).blur(function(){b(),e(this).val(""),D.removeClass(a.classes.focused)}).bind("keyup keydown blur update",l).keydown(function(t){var n,s;switch(t.keyCode){case i.LEFT:case i.RIGHT:case i.UP:case i.DOWN:if(e(this).val()){var a=null;a=t.keyCode===i.DOWN||t.keyCode===i.RIGHT?e(Y).next():e(Y).prev(),a.length&&E(a)}else n=H.prev(),s=H.next(),n.length&&n.get(0)===M||s.length&&s.get(0)===M?t.keyCode===i.LEFT||t.keyCode===i.UP?h(e(M),r.BEFORE):h(e(M),r.AFTER):t.keyCode!==i.LEFT&&t.keyCode!==i.UP||!n.length?t.keyCode!==i.RIGHT&&t.keyCode!==i.DOWN||!s.length||p(e(s.get(0))):p(e(n.get(0)));return!1;case i.BACKSPACE:if(n=H.prev(),!e(this).val().length)return M?(g(e(M)),F.change()):n.length&&p(e(n.get(0))),!1;1===e(this).val().length?b():setTimeout(function(){C()},5);break;case i.TAB:case i.ENTER:case i.NUMPAD_ENTER:case i.COMMA:if(Y)return d(e(Y).data("tokeninput")),F.change(),!1;break;case i.ESCAPE:return b(),!0;default:String.fromCharCode(t.which)&&setTimeout(function(){C()},5)}}),F=e(t).hide().val("").focus(function(){T(N)}).blur(function(){N.blur()}),M=null,B=0,Y=null,D=e("<ul />").addClass(a.classes.tokenList).click(function(t){var n=e(t.target).closest("li");n&&n.get(0)&&e.data(n.get(0),"tokeninput")?f(n):(M&&h(e(M),r.END),T(N))}).mouseover(function(t){var n=e(t.target).closest("li");n&&M!==this&&n.addClass(a.classes.highlightedToken)}).mouseout(function(t){var n=e(t.target).closest("li");n&&M!==this&&n.removeClass(a.classes.highlightedToken)}).insertBefore(F),H=e("<li />").addClass(a.classes.inputToken).appendTo(D).append(N),z=e("<div>").addClass(a.classes.dropdown).appendTo("body").hide(),G=e("<tester/>").insertAfter(N).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:N.css("fontSize"),fontFamily:N.css("fontFamily"),fontWeight:N.css("fontWeight"),letterSpacing:N.css("letterSpacing"),whiteSpace:"nowrap"});F.val("");var W=a.prePopulate||F.data("pre");a.processPrePopulate&&e.isFunction(a.onResult)&&(W=a.onResult.call(F,W)),W&&W.length&&e.each(W,function(e,t){c(t),u()}),a.disabled&&o(!0),e.isFunction(a.onReady)&&a.onReady.call(),this.clear=function(){D.children("li").each(function(){0===e(this).children("input").length&&g(e(this))})},this.add=function(e){d(e)},this.remove=function(t){D.children("li").each(function(){if(0===e(this).children("input").length){var n=e(this).data("tokeninput"),r=!0;for(var i in t)if(t[i]!==n[i]){r=!1;break}r&&g(e(this))}})},this.getTokens=function(){return O},this.toggleDisabled=function(e){o(e)};var V=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g")},e.TokenList.Cache=function(t){var n=e.extend({max_size:500},t),r={},i=0,s=function(){r={},i=0};this.add=function(e,t){i>n.max_size&&s(),r[e]||(i+=1),r[e]=t},this.get=function(e){return r[e]}}}(jQuery);