!function(e){var t={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:!0,theme:null,zindex:999,resultsLimit:null,resultsFormatter:function(e){return"<li>"+e[this.propertyToSearch]+"</li>"},tokenFormatter:function(e){return"<li><p>"+e[this.propertyToSearch]+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",onResult:null,onAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1},n={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"},i={BEFORE:0,AFTER:1,END:2},r={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},o={init:function(n,i){var r=e.extend({},t,i||{});return this.each(function(){e(this).data("tokenInputObject",new e.TokenList(this,n,r))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(e){return this.data("tokenInputObject").add(e),this},remove:function(e){return this.data("tokenInputObject").remove(e),this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(e){return this.data("tokenInputObject").toggleDisabled(e),this}};e.fn.tokenInput=function(e){return o[e]?o[e].apply(this,Array.prototype.slice.call(arguments,1)):o.init.apply(this,arguments)},e.TokenList=function(t,o,s){function a(t){"boolean"==typeof t?s.disabled=t:s.disabled=!s.disabled,O.prop("disabled",s.disabled),$.toggleClass(s.classes.disabled,s.disabled),F&&p(e(F),i.END),H.prop("disabled",s.disabled)}function l(){if(null!==s.tokenLimit&&A>=s.tokenLimit)return O.hide(),void v()}function u(){if(I!==(I=O.val())){var e=I.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");W.html(e),O.width(W.width()+30)}}function d(t){var n=e(s.tokenFormatter(t)),i=t.readonly===!0;i&&n.addClass(s.classes.tokenReadOnly),n.addClass(s.classes.token).insertBefore(z),i||e("<span>"+s.deleteText+"</span>").addClass(s.classes.tokenDelete).appendTo(n).click(function(){if(!s.disabled)return m(e(this).parent()),H.change(),!1});var r=t;return e.data(n.get(0),"tokeninput",t),j=j.slice(0,N).concat([r]).concat(j.slice(N)),N++,g(j,H),A+=1,null!==s.tokenLimit&&A>=s.tokenLimit&&(O.hide(),v()),n}function c(t){var n=s.onAdd;if(A>0&&s.preventDuplicates){var i=null;if($.children().each(function(){var n=e(this),r=e.data(n.get(0),"tokeninput");if(r&&r.id===t.id)return i=n,!1}),i)return h(i),z.insertAfter(i),void D(O)}(null==s.tokenLimit||A<s.tokenLimit)&&(d(t),l()),O.val(""),v(),e.isFunction(n)&&n.call(H,t)}function h(e){s.disabled||(e.addClass(s.classes.selectedToken),F=e.get(0),O.val(""),v())}function p(e,t){e.removeClass(s.classes.selectedToken),F=null,t===i.BEFORE?(z.insertBefore(e),N--):t===i.AFTER?(z.insertAfter(e),N++):(z.appendTo($),N=A),D(O)}function f(t){var n=F;F&&p(e(F),i.END),n===t.get(0)?p(t,i.END):h(t)}function m(t){var n=e.data(t.get(0),"tokeninput"),i=s.onDelete,r=t.prevAll().length;r>N&&r--,t.remove(),F=null,D(O),j=j.slice(0,r).concat(j.slice(r+1)),r<N&&N--,g(j,H),A-=1,null!==s.tokenLimit&&(O.show().val(""),D(O)),e.isFunction(i)&&i.call(H,n)}function g(t,n){var i=e.map(t,function(e){return"function"==typeof s.tokenValue?s.tokenValue.call(this,e):e[s.tokenValue]});n.val(i.join(s.tokenDelimiter))}function v(){U.hide().empty(),R=null}function y(){U.css({position:"absolute",top:e($).offset().top+e($).outerHeight(),left:e($).offset().left,width:e($).outerWidth(),"z-index":s.zindex}).show()}function b(){s.searchingText&&(U.html("<p>"+s.searchingText+"</p>"),y())}function _(){s.hintText&&(U.html("<p>"+s.hintText+"</p>"),y())}function w(e){return e.replace(V,"\\$&")}function x(e,t){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+w(t)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")}function k(e,t,n){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+w(t)+")(?![^<>]*>)(?![^&;]+;)","g"),x(t,n))}function T(t,n){if(n&&n.length){U.empty();var i=e("<ul>").appendTo(U).mouseover(function(t){M(e(t.target).closest("li"))}).mousedown(function(t){return c(e(t.target).closest("li").data("tokeninput")),H.change(),!1}).hide();s.resultsLimit&&n.length>s.resultsLimit&&(n=n.slice(0,s.resultsLimit)),e.each(n,function(n,r){var o=s.resultsFormatter(r);o=k(o,r[s.propertyToSearch],t),o=e(o).appendTo(i),n%2?o.addClass(s.classes.dropdownItem):o.addClass(s.classes.dropdownItem2),0===n&&M(o),e.data(o.get(0),"tokeninput",r)}),y(),s.animateDropdown?i.slideDown("fast"):i.show()}else s.noResultsText&&(U.html("<p>"+s.noResultsText+"</p>"),y())}function M(t){t&&(R&&S(e(R)),t.addClass(s.classes.selectedDropdownItem),R=t.get(0))}function S(e){e.removeClass(s.classes.selectedDropdownItem),R=null}function L(){var t=O.val();t&&t.length&&(F&&p(e(F),i.AFTER),t.length>=s.minChars?(b(),clearTimeout(Y),Y=setTimeout(function(){C(t)},s.searchDelay)):v())}function C(t){var n=t+E(),i=P.get(n);if(i)T(t,i);else if(s.url){var r=E(),o={};if(o.data={},r.indexOf("?")>-1){var a=r.split("?");o.url=a[0];var l=a[1].split("&");e.each(l,function(e,t){var n=t.split("=");o.data[n[0]]=n[1]})}else o.url=r;o.data[s.queryParam]=t,o.type=s.method,o.dataType=s.contentType,s.crossDomain&&(o.dataType="jsonp"),o.success=function(i){e.isFunction(s.onResult)&&(i=s.onResult.call(H,i)),P.add(n,s.jsonContainer?i[s.jsonContainer]:i),O.val()===t&&T(t,s.jsonContainer?i[s.jsonContainer]:i)},e.ajax(o)}else if(s.local_data){var u=e.grep(s.local_data,function(e){return e[s.propertyToSearch].toLowerCase().indexOf(t.toLowerCase())>-1});e.isFunction(s.onResult)&&(u=s.onResult.call(H,u)),P.add(n,u),T(t,u)}}function E(){var e=s.url;return"function"==typeof s.url&&(e=s.url.call(s)),e}function D(e){setTimeout(function(){e.focus()},50)}if("string"===e.type(o)||"function"===e.type(o)){s.url=o;var q=E();void 0===s.crossDomain&&"string"==typeof q&&(q.indexOf("://")===-1?s.crossDomain=!1:s.crossDomain=location.href.split(/\/+/g)[1]!==q.split(/\/+/g)[1])}else"object"==typeof o&&(s.local_data=o);s.classes?s.classes=e.extend({},n,s.classes):s.theme?(s.classes={},e.each(n,function(e,t){s.classes[e]=t+"-"+s.theme})):s.classes=n;var Y,I,j=[],A=0,P=new e.TokenList.Cache,O=e('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",s.idPrefix+t.id).focus(function(){return!s.disabled&&(null!==s.tokenLimit&&s.tokenLimit===A||_(),void $.addClass(s.classes.focused))}).blur(function(){v(),e(this).val(""),$.removeClass(s.classes.focused)}).bind("keyup keydown blur update",u).keydown(function(t){var n,o;switch(t.keyCode){case r.LEFT:case r.RIGHT:case r.UP:case r.DOWN:if(e(this).val()){var s=null;s=t.keyCode===r.DOWN||t.keyCode===r.RIGHT?e(R).next():e(R).prev(),s.length&&M(s)}else n=z.prev(),o=z.next(),n.length&&n.get(0)===F||o.length&&o.get(0)===F?t.keyCode===r.LEFT||t.keyCode===r.UP?p(e(F),i.BEFORE):p(e(F),i.AFTER):t.keyCode!==r.LEFT&&t.keyCode!==r.UP||!n.length?t.keyCode!==r.RIGHT&&t.keyCode!==r.DOWN||!o.length||h(e(o.get(0))):h(e(n.get(0)));return!1;case r.BACKSPACE:if(n=z.prev(),!e(this).val().length)return F?(m(e(F)),H.change()):n.length&&h(e(n.get(0))),!1;1===e(this).val().length?v():setTimeout(function(){L()},5);break;case r.TAB:case r.ENTER:case r.NUMPAD_ENTER:case r.COMMA:if(R)return c(e(R).data("tokeninput")),H.change(),!1;break;case r.ESCAPE:return v(),!0;default:String.fromCharCode(t.which)&&setTimeout(function(){L()},5)}}),H=e(t).hide().val("").focus(function(){D(O)}).blur(function(){O.blur()}),F=null,N=0,R=null,$=e("<ul />").addClass(s.classes.tokenList).click(function(t){var n=e(t.target).closest("li");n&&n.get(0)&&e.data(n.get(0),"tokeninput")?f(n):(F&&p(e(F),i.END),D(O))}).mouseover(function(t){var n=e(t.target).closest("li");n&&F!==this&&n.addClass(s.classes.highlightedToken)}).mouseout(function(t){var n=e(t.target).closest("li");n&&F!==this&&n.removeClass(s.classes.highlightedToken)}).insertBefore(H),z=e("<li />").addClass(s.classes.inputToken).appendTo($).append(O),U=e("<div>").addClass(s.classes.dropdown).appendTo("body").hide(),W=e("<tester/>").insertAfter(O).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:O.css("fontSize"),fontFamily:O.css("fontFamily"),fontWeight:O.css("fontWeight"),letterSpacing:O.css("letterSpacing"),whiteSpace:"nowrap"});H.val("");var B=s.prePopulate||H.data("pre");s.processPrePopulate&&e.isFunction(s.onResult)&&(B=s.onResult.call(H,B)),B&&B.length&&e.each(B,function(e,t){d(t),l()}),s.disabled&&a(!0),e.isFunction(s.onReady)&&s.onReady.call(),this.clear=function(){$.children("li").each(function(){0===e(this).children("input").length&&m(e(this))})},this.add=function(e){c(e)},this.remove=function(t){$.children("li").each(function(){if(0===e(this).children("input").length){var n=e(this).data("tokeninput"),i=!0;for(var r in t)if(t[r]!==n[r]){i=!1;break}i&&m(e(this))}})},this.getTokens=function(){return j},this.toggleDisabled=function(e){a(e)};var V=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g")},e.TokenList.Cache=function(t){var n=e.extend({max_size:500},t),i={},r=0,o=function(){i={},r=0};this.add=function(e,t){r>n.max_size&&o(),i[e]||(r+=1),i[e]=t},this.get=function(e){return i[e]}}}(jQuery);