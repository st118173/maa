!function(e){e.widget("ra.remoteForm",{_create:function(){var t=this,n=t.element,i=n.find("select").first().data("options")&&n.find("select").first().data("options")["edit-url"];"undefined"!=typeof i&&i.length&&n.on("dblclick",".ra-multiselect option:not(:disabled)",function(e){t._bindModalOpening(e,i.replace("__ID__",this.value))}),n.find(".create").unbind().bind("click",function(n){t._bindModalOpening(n,e(this).data("link"))}),n.find(".update").unbind().bind("click",function(i){(value=n.find("select").val())?t._bindModalOpening(i,e(this).data("link").replace("__ID__",value)):i.preventDefault()})},_bindModalOpening:function(t,n){if(t.preventDefault(),widget=this,e("#modal").length)return!1;var i=this._getModal();setTimeout(function(){e.ajax({url:n,beforeSend:function(e){e.setRequestHeader("Accept","text/javascript")},success:function(e){i.find(".modal-body").html(e),widget._bindFormEvents()},error:function(e){i.find(".modal-body").html(e.responseText)},dataType:"text"})},200)},_bindFormEvents:function(){var t=this,n=this._getModal(),i=n.find("form"),r=n.find(":submit[name=_save]").html(),o=n.find(":submit[name=_continue]").html();n.find(".form-actions").remove(),i.attr("data-remote",!0),n.find(".modal-header-title").text(i.data("title")),n.find(".cancel-action").unbind().click(function(){return n.modal("hide"),!1}).html(o),n.find(".save-action").unbind().click(function(){return i.submit(),!1}).html(r),e(document).trigger("rails_admin.dom_ready",[i]),i.bind("ajax:complete",function(i,r,o){if("error"==o)n.find(".modal-body").html(r.responseText),t._bindFormEvents();else{var s=e.parseJSON(r.responseText),a='<option value="'+s.id+'" selected>'+s.label+"</option>",l=t.element.find("select").filter(":hidden");if(t.element.find(".filtering-select").length){var u=t.element.find(".filtering-select").children(".ra-filtering-select-input");u.val(s.label),l.find("option[value="+s.id+"]").length||(l.html(a).val(s.id),t.element.find(".update").removeClass("disabled"))}else{var u=t.element.find(".ra-filtering-select-input"),d=t.element.find(".ra-multiselect");d.find("option[value="+s.id+"]").length?(l.find("option[value="+s.id+"]").text(s.label),d.find("option[value= "+s.id+"]").text(s.label)):(l.append(a),d.find("select.ra-multiselect-selection").append(a))}t._trigger("success"),n.modal("hide")}})},_getModal:function(){var t=this;return t.dialog||(t.dialog=e('<div id="modal" class="modal fade">            <div class="modal-dialog">            <div class="modal-content">            <div class="modal-header">              <a href="#" class="close" data-dismiss="modal">&times;</a>              <h3 class="modal-header-title">...</h3>            </div>            <div class="modal-body">              ...            </div>            <div class="modal-footer">              <a href="#" class="btn cancel-action">...</a>              <a href="#" class="btn btn-primary save-action">...</a>            </div>            </div>            </div>          </div>').modal({keyboard:!0,backdrop:!0,show:!0}).on("hidden.bs.modal",function(){t.dialog.remove(),t.dialog=null})),this.dialog}})}(jQuery);