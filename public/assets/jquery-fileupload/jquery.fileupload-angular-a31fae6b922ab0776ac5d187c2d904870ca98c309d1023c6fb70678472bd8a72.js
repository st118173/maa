!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","angular","./jquery.fileupload-image","./jquery.fileupload-audio","./jquery.fileupload-video","./jquery.fileupload-validate"],e):e()}(function(){"use strict";angular.module("blueimp.fileupload",[]).provider("fileUpload",function(){var e,t=function(e){var t=angular.element(this).fileupload("option","scope");t.$evalAsync(e)},i=function(e,t){var i=t.files,n=i[0];angular.forEach(i,function(e,i){e._index=i,e.$state=function(){return t.state()},e.$processing=function(){return t.processing()},e.$progress=function(){return t.progress()},e.$response=function(){return t.response()}}),n.$submit=function(){if(!n.error)return t.submit()},n.$cancel=function(){return t.abort()}};e=this.defaults={handleResponse:function(e,t){var i=t.result&&t.result.files;i?t.scope.replace(t.files,i):(t.errorThrown||"error"===t.textStatus)&&(t.files[0].error=t.errorThrown||t.textStatus)},add:function(e,t){if(e.isDefaultPrevented())return!1;var n=t.scope,r=[];angular.forEach(t.files,function(e){r.push(e)}),n.$parent.$applyAsync(function(){i(n,t);var e=n.option("prependFiles")?"unshift":"push";Array.prototype[e].apply(n.queue,t.files)}),t.process(function(){return n.process(t)}).always(function(){n.$parent.$applyAsync(function(){i(n,t),n.replace(r,t.files)})}).then(function(){(n.option("autoUpload")||t.autoUpload)&&t.autoUpload!==!1&&t.submit()})},done:function(e,t){if(e.isDefaultPrevented())return!1;var i=this;t.scope.$apply(function(){t.handleResponse.call(i,e,t)})},fail:function(e,t){if(e.isDefaultPrevented())return!1;var i=this,n=t.scope;return"abort"===t.errorThrown?void n.clear(t.files):void n.$apply(function(){t.handleResponse.call(i,e,t)})},stop:t,processstart:t,processstop:t,getNumberOfFiles:function(){var e=this.scope;return e.queue.length-e.processing()},dataType:"json",autoUpload:!1},this.$get=[function(){return{defaults:e}}]}).provider("formatFileSizeFilter",function(){var e={units:[{size:1e9,suffix:" GB"},{size:1e6,suffix:" MB"},{size:1e3,suffix:" KB"}]};this.defaults=e,this.$get=function(){return function(t){if(!angular.isNumber(t))return"";for(var i,n,r=!0,o=0;r;){if(r=e.units[o],i=r.prefix||"",n=r.suffix||"",o===e.units.length-1||t>=r.size)return i+(t/r.size).toFixed(2)+n;o+=1}}}}).controller("FileUploadController",["$scope","$element","$attrs","$window","fileUpload",function(e,t,i,n,r){var o={progress:function(){return t.fileupload("progress")},active:function(){return t.fileupload("active")},option:function(e,i){return 1===arguments.length?t.fileupload("option",e):void t.fileupload("option",e,i)},add:function(e){return t.fileupload("add",e)},send:function(e){return t.fileupload("send",e)},process:function(e){return t.fileupload("process",e)},processing:function(e){return t.fileupload("processing",e)}};e.disabled=!n.jQuery.support.fileInput,e.queue=e.queue||[],e.clear=function(e){var t=this.queue,i=t.length,n=e,r=1;for(angular.isArray(e)&&(n=e[0],r=e.length);i;)if(i-=1,t[i]===n)return t.splice(i,r)},e.replace=function(e,t){var i,n,r=this.queue,o=e[0];for(i=0;i<r.length;i+=1)if(r[i]===o){for(n=0;n<t.length;n+=1)r[i+n]=t[n];return}},e.applyOnQueue=function(e){var t,i,n=this.queue.slice(0);for(t=0;t<n.length;t+=1)i=n[t],i[e]&&i[e]()},e.submit=function(){this.applyOnQueue("$submit")},e.cancel=function(){this.applyOnQueue("$cancel")},angular.extend(e,o),t.fileupload(angular.extend({scope:e},r.defaults)).on("fileuploadadd",function(t,i){i.scope=e}).on("fileuploadfail",function(e,t){if("abort"!==t.errorThrown&&t.dataType&&t.dataType.indexOf("json")===t.dataType.length-4)try{t.result=angular.fromJson(t.jqXHR.responseText)}catch(e){}}).on(["fileuploadadd","fileuploadsubmit","fileuploadsend","fileuploaddone","fileuploadfail","fileuploadalways","fileuploadprogress","fileuploadprogressall","fileuploadstart","fileuploadstop","fileuploadchange","fileuploadpaste","fileuploaddrop","fileuploaddragover","fileuploadchunksend","fileuploadchunkdone","fileuploadchunkfail","fileuploadchunkalways","fileuploadprocessstart","fileuploadprocess","fileuploadprocessdone","fileuploadprocessfail","fileuploadprocessalways","fileuploadprocessstop"].join(" "),function(t,i){e.$parent.$applyAsync(function(){e.$emit(t.type,i).defaultPrevented&&t.preventDefault()})}).on("remove",function(){var t;for(t in o)o.hasOwnProperty(t)&&delete e[t]}),e.$watch(i.fileUpload,function(e){e&&t.fileupload("option",e)})}]).controller("FileUploadProgressController",["$scope","$attrs","$parse",function(e,t,i){var n=i(t.fileUploadProgress),r=function(){var t=n(e);t&&t.total&&(e.num=Math.floor(t.loaded/t.total*100))};r(),e.$watch(t.fileUploadProgress+".loaded",function(e,t){e!==t&&r()})}]).controller("FileUploadPreviewController",["$scope","$element","$attrs",function(e,t,i){e.$watch(i.fileUploadPreview+".preview",function(e){t.empty(),e&&t.append(e)})}]).directive("fileUpload",function(){return{controller:"FileUploadController",scope:!0}}).directive("fileUploadProgress",function(){return{controller:"FileUploadProgressController",scope:!0}}).directive("fileUploadPreview",function(){return{controller:"FileUploadPreviewController"}}).directive("download",function(){return function(e,t){t.on("dragstart",function(e){try{e.originalEvent.dataTransfer.setData("DownloadURL",["application/octet-stream",t.prop("download"),t.prop("href")].join(":"))}catch(e){}})}})});